#!/bin/bash
# 高级：切换主题、重装脚本
[ -f /xrk/shell_modules/menu_common.sh ] && source /xrk/shell_modules/menu_common.sh
menu_init 0 1  # 初始化：不需要common，需要check_changes（检测xyz/tyz/myz）

# 主题键与显示名一一对应
THEMES=(".theme" ".theme2" ".theme3" ".theme4" ".theme5" ".theme6" ".theme7" ".theme8" ".theme9" ".theme10" ".theme11" ".theme12" ".theme13")
THEME_NAMES=("向日葵原版主题" "暗夜锋芒" "甜心微爱" "极光幻境" "霓虹都市" "薄暮流云" "科技未来" "沙漠晨曦" "深海之谜" "森林密语" "莓果甜心" "星空梦境" "金属光泽")

while true; do
    # 使用统一菜单显示函数
    menu_show "脚本高级菜单" "切换脚本主题" "重装脚本"
    echo
    read -p "输入要管理的序号 [1-2]，q 退出: " patch
    forin=8 clear_menu
    case $patch in
        1)
            # 主题子菜单（使用统一函数）
            menu_show "切换脚本主题" "${THEME_NAMES[@]}"
            echo
            read -p "选择主题 [1-13]，q 返回: " color
            forin=19 clear_menu
            if [[ "$color" =~ ^[0-9]+$ ]] && [ "$color" -ge 1 ] && [ "$color" -le 13 ]; then
                yq -i '.color = "'"${THEMES[$((color-1))]}"'"' /xrk/system.yaml
                chmod 755 /xrk/.init
                . /xrk/.init
                echo -e "${caidan1}更改${bg}${caidan2}完成${bg}"
                exit 0
            fi
            ;;
        2)
            if [ -n "$xyz" ]; then
                bash /xrk/body/xrkwrite.sh
            elif [ -n "$tyz" ]; then
                bash /xrk/body/trsswrite.sh
            elif [ -n "$myz" ]; then
                bash /xrk/body/miaowrite.sh
            else
                echo -e "${red}未检测到云崽/时雨/喵崽路径，请先安装主流程${bg}"
                read -p "按回车返回..." _
            fi
            ;;
        *)
            echo -e "${red}退出咯${bg}"
            exit 1
            ;;
    esac
done
